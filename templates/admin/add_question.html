{% extends "base.html" %}

{% block title %}Manage Questions for "{{ quiz_pack.title }}"{% endblock %}

{% block content %}
    <div class="container">
        <div class="panel-header text-center">
            <div class="panel-title h5 mt-10">Add Question #{{ next_question_number }} to "{{ quiz_pack.title }}"</div>
        </div>
        <div class="panel-body">
            <form action="{{ url_for('admin.add_question', quiz_id=quiz_pack.id) }}" method="POST" class="form-horizontal">
                <div class="form-group">
                    <div class="col-3 col-sm-12">
                        <label class="form-label" for="question_text">Question Text</label>
                    </div>
                    <div class="col-9 col-sm-12">
                        <textarea class="form-input" id="question_text" name="question_text" placeholder="Enter question text" required rows="10" cols="50"></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-3 col-sm-12">
                        <label class="form-label" for="image_url">Image URL (optional)</label>
                    </div>
                    <div class="col-9 col-sm-12">
                        <input class="form-input" type="text" id="image_url" name="image_url" placeholder="E.g., /static/img/HarryPotter/1pack/question1.jpg">
                        <p class="form-input-hint">Use image URL. For local images: /static/your_file.jpg</p>
                    </div>
                </div>
                <div class="divider text-center" data-content="Answer Options"></div>
                <div class="form-group">
                    <div class="col-3 col-sm-12">
                        <label class="form-label" for="option_0">Option A</label>
                    </div>
                    <div class="col-9 col-sm-12">
                        <input class="form-input" type="text" id="option_0" name="option_0" required>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-3 col-sm-12">
                        <label class="form-label" for="option_1">Option B</label>
                    </div>
                    <div class="col-9 col-sm-12">
                        <input class="form-input" type="text" id="option_1" name="option_1" required>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-3 col-sm-12">
                        <label class="form-label" for="option_2">Option C</label>
                    </div>
                    <div class="col-9 col-sm-12">
                        <input class="form-input" type="text" id="option_2" name="option_2" required>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-3 col-sm-12">
                        <label class="form-label" for="option_3">Option D</label> {# Label is now 'Option D' #}
                    </div>
                    <div class="col-9 col-sm-12">
                        <input class="form-input" type="text" id="option_3" name="option_3" required> {# name="option_3" #}
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-3 col-sm-12">
                        <label class="form-label" for="correct_answer">Correct Answer (A, B, C, D)</label> {# Field name and label changed #}
                    </div>
                    <div class="col-9 col-sm-12">
                        <input class="form-input" type="text" id="correct_answer" name="correct_answer" pattern="[ABCDabcd]" title="Enter A, B, C or D" required> {# pattern for letters #}
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-12 text-center">
                        <button type="submit" class="btn btn-primary">Add Question</button>
                    </div>
                </div>
            </form>
        </div>

        {# List of existing questions #}
        <div class="divider text-center" data-content="Existing Questions"></div>
        <div class="panel-body">
            {% if quiz_pack.questions %}
                <ul class="list-group">
                    {% for question_item in quiz_pack.questions %}
                        <li class="list-group-item" style="margin-bottom: 10px; border: 1px solid #e0e0e0; border-radius: 4px; padding: 15px;">
                            <div class="tile tile-centered">
                                <div class="tile-content">
                                    <p class="tile-title" style="font-weight: bold; margin-bottom: 5px;">{{ loop.index }}. {{ question_item.question_text }}</p>
                                    {# Display correct answer as a letter and text #}
                                    {% set answer_letters = ['A', 'B', 'C', 'D'] %}
                                    {% set options_list = question_item.get_options() %}
                                    <small style="display: block; margin-bottom: 3px;">
                                        Correct Answer: {% if question_item.correct_answer_index is not none and question_item.correct_answer_index >= 0 and question_item.correct_answer_index < options_list|length %}
                                            {{ answer_letters[question_item.correct_answer_index] }}. {{ options_list[question_item.correct_answer_index] }}
                                        {% else %}
                                            Index Invalid ({{ question_item.correct_answer_index }})
                                        {% endif %}
                                    </small><br>
                                    {% if question_item.image_url %}
                                    <small style="display: block;">Image: {{ question_item.image_url }}</small>
                                    {% endif %}
                                </div>
                                <div class="tile-action" style="display: flex; gap: 8px; align-items: center;">
                                    <a href="{{ url_for('admin.edit_question', question_id=question_item.id) }}" class="btn btn-link btn-sm">Edit</a>
                                    <form action="{{ url_for('admin.delete_question', question_id=question_item.id) }}" method="POST" style="display:inline-block;" onsubmit="return confirm('Are you sure you want to delete this question?');">
                                        <button type="submit" class="btn btn-error btn-sm">Delete</button>
                                    </form>
                                </div>
                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-center">This quiz pack currently has no questions.</p>
            {% endif %}
        </div>

        <div class="panel-footer text-center">
            <a href="{{ url_for('admin.dashboard') }}" class="btn btn-primary">Back to Admin Dashboard</a>
        </div>
    </div>
{% endblock %}